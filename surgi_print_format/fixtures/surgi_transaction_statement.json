[
    {
        "name": "Surgi Transaction Statement",
        "standard": true,
        "print_format_for": "DocType",
        "doc_type": "Customer Statement",
        "print_format_type": "Jinja",
        "margin_top": 15,
        "margin_bottom": 15,
        "margin_left": 15,
        "margin_right": 15,
        "html": "{, --- Initialize and calculate balance first --- #} {% set ns = namespace(total\_amount=0, total\_received=0) %} {% set today = frappe.utils.getdate() %} {, Get customer details #} {% set customer\_doc = frappe.get\_doc(\"Customer\", doc.customer) %} {, Get all Sales Invoices for the period #} {% set invoices = frappe.get\_all(\"Sales Invoice\", filters={ \"customer\": doc.customer, \"docstatus\": 1, \"posting\_date\": [\"between\", [doc.from\_date, doc.to\_date]] }, fields=[\"name\", \"posting\_date\", \"grand\_total\", \"outstanding\_amount\"], order\_by=\"posting\_date asc\") %} {, Calculate totals #} {% for inv in invoices %} {% set ns.total\_amount = ns.total\_amount + inv.grand\_total %} {% set paid = inv.grand\_total - inv.outstanding\_amount %} {% set ns.total\_received = ns.total\_received + paid %} {% endfor %}  |  |  |  |  | | --- | --- | --- | --- | | **SurgiShop**  19235 N US Highway 41  Lutz, FL 33549  +18557202285  accounting@surgishop.com  www.SurgiShop.com Transaction Statement **TO**  {{ customer\_doc.customer\_name }}  {% if customer\_doc.customer\_primary\_contact %} {% set contact = frappe.get\_doc(\"Contact\", customer\_doc.customer\_primary\_contact) %} {{ contact.first\_name }} {{ contact.last\_name }}  {% endif %} {% if customer\_doc.customer\_primary\_address %} {% set address = frappe.get\_doc(\"Address\", customer\_doc.customer\_primary\_address) %} {{ address.address\_line1 }}  {% if address.address\_line2 %}{{ address.address\_line2 }} {% endif %} {{ address.city }}, {{ address.state }} {{ address.pincode }} {{ address.country }} {% endif %} | Logo  |  |  | | --- | --- | | **DATE** | {{ doc.posting\_date or today }} | |  | DATE | DESCRIPTION | AMOUNT | RECEIVED | | --- | --- | --- | --- | {, Invoice Entries #} {% for inv in invoices %} {% set paid = inv.grand\_total - inv.outstanding\_amount %}| {{ inv.posting\_date }} | Invoice {{ inv.name }} | {{ \"{:,.2f}\".format(inv.grand\_total) }} | {{ \"{:,.2f}\".format(paid) }} | {% endfor %} {, Dotted line separator #}|  | | | | {, Total row #}|  |  | TOTAL AMOUNT: $ {{ \"{:,.2f}\".format(ns.total\_amount) }} | TOTAL RECEIVED: $ {{ \"{:,.2f}\".format(ns.total\_received) }} |  **Pay your Invoice Online: Pay.SurgiShop.com**  For more information please email Accounting@SurgiShop.com",
        "doctype": "Print Format"
    }
]
