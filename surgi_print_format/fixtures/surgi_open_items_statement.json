[
    {
        "name": "Surgi Open Items Statement",
        "standard": true,
        "print_format_for": "DocType",
        "doc_type": "Customer Statement",
        "print_format_type": "Jinja",
        "margin_top": 15,
        "margin_bottom": 15,
        "margin_left": 15,
        "margin_right": 15,
        "html": "{, --- Initialize and calculate balance first --- #} {% set ns = namespace(total\_open=0) %} {% set today = frappe.utils.getdate() %} {, Get customer details #} {% set customer\_doc = frappe.get\_doc(\"Customer\", doc.customer) %} {, Get all unpaid Sales Invoices #} {% set invoices = frappe.get\_all(\"Sales Invoice\", filters={ \"customer\": doc.customer, \"docstatus\": 1, \"outstanding\_amount\": [\">\", 0] }, fields=[\"name\", \"posting\_date\", \"grand\_total\", \"outstanding\_amount\"], order\_by=\"posting\_date asc\") %} {, Get all unapplied Payment Entries (credits) #} {% set payments = frappe.get\_all(\"Payment Entry\", filters={ \"party\_type\": \"Customer\", \"party\": doc.customer, \"docstatus\": 1, \"unallocated\_amount\": [\">\", 0] }, fields=[\"name\", \"posting\_date\", \"paid\_amount\", \"unallocated\_amount\"], order\_by=\"posting\_date asc\") %} {, Calculate total open amount #} {% for inv in invoices %} {% set ns.total\_open = ns.total\_open + inv.outstanding\_amount %} {% endfor %} {% for pmt in payments %} {% set ns.total\_open = ns.total\_open - pmt.unallocated\_amount %} {% endfor %}  |  |  |  |  |  |  | | --- | --- | --- | --- | --- | --- | | **SurgiShop**  19235 N US Highway 41  Lutz, FL 33549  +18557202285  accounting@surgishop.com  www.SurgiShop.com Open Items Statement **TO**  {{ customer\_doc.customer\_name }}  {% if customer\_doc.customer\_primary\_contact %} {% set contact = frappe.get\_doc(\"Contact\", customer\_doc.customer\_primary\_contact) %} {{ contact.first\_name }} {{ contact.last\_name }}  {% endif %} {% if customer\_doc.customer\_primary\_address %} {% set address = frappe.get\_doc(\"Address\", customer\_doc.customer\_primary\_address) %} {{ address.address\_line1 }}  {% if address.address\_line2 %}{{ address.address\_line2 }} {% endif %} {{ address.city }}, {{ address.state }} {{ address.pincode }} {{ address.country }} {% endif %} | Logo  |  |  | | --- | --- | | **DATE** | {{ doc.posting\_date or today }} | | **TOTAL DUE ENCLOSED** | $ {{ \"{:,.2f}\".format(ns.total\_open) }} | |  | DATE | DESCRIPTION | AMOUNT | OPEN AMOUNT | | --- | --- | --- | --- | {, Invoice Entries #} {% for inv in invoices %}| {{ inv.posting\_date }} | Invoice {{ inv.name }} | {{ \"{:,.2f}\".format(inv.grand\_total) }} | {{ \"{:,.2f}\".format(inv.outstanding\_amount) }} | {% endfor %} {, Credit/Payment Entries #} {% for pmt in payments %}| {{ pmt.posting\_date }} | Credit {{ pmt.name }} | {{ \"{:,.2f}\".format(pmt.paid\_amount) }} | -{{ \"{:,.2f}\".format(pmt.unallocated\_amount) }} | {% endfor %}  {, Past-Due / Aging - break down by invoice age #} {% set days\_1\_30 = 0 %} {% set days\_31\_60 = 0 %} {% set days\_61\_90 = 0 %} {% set days\_over\_90 = 0 %} {% for inv in frappe.get\_all(\"Sales Invoice\", filters={ \"customer\": doc.customer, \"docstatus\": 1, \"outstanding\_amount\": [\">\", 0] }, fields=[\"posting\_date\", \"outstanding\_amount\"]) %} {% set amt = inv.outstanding\_amount %} {% set days\_due = (today - inv.posting\_date).days %} {% if days\_due >= 1 and days\_due <= 30 %} {% set days\_1\_30 = days\_1\_30 + amt %} {% elif days\_due >= 31 and days\_due <= 60 %} {% set days\_31\_60 = days\_31\_60 + amt %} {% elif days\_due >= 61 and days\_due <= 90 %} {% set days\_61\_90 = days\_61\_90 + amt %} {% elif days\_due > 90 %} {% set days\_over\_90 = days\_over\_90 + amt %} {% endif %} {% endfor %}  | Current Due | 1-30 Days Past Due | 31-60 Days Past Due | 61-90 Days Past Due | 90+ Days Past Due | Amount Due | | --- | --- | --- | --- | --- | --- | | {{ \"{:,.2f}\".format(ns.total\_open) }} | {{ \"{:,.2f}\".format(days\_1\_30) }} | {{ \"{:,.2f}\".format(days\_31\_60) }} | {{ \"{:,.2f}\".format(days\_61\_90) }} | {{ \"{:,.2f}\".format(days\_over\_90) }} | {{ \"{:,.2f}\".format(ns.total\_open) }} |  **Pay your Invoice Online: Pay.SurgiShop.com**  For more information please email Accounting@SurgiShop.com",
        "doctype": "Print Format"
    }
]
